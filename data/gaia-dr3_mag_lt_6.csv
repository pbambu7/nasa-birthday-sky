# generate_gaia_dr3_csv.py
# ---------------------------------------
# Downloads a bright-star subset from Gaia DR3 (G < 6)
# and saves it as a CSV for use in NASA Birthday Sky
# ---------------------------------------

from astroquery.gaia import Gaia
import pandas as pd
from pathlib import Path

# Output path
DATA_DIR = Path("data")
DATA_DIR.mkdir(exist_ok=True)
OUTPUT_CSV = DATA_DIR / "gaia_dr3_mag_lt_6.csv"

print("ðŸ”­ Querying Gaia DR3 (this may take ~1â€“2 minutes)...")

query = """
SELECT
    source_id,
    ra,
    dec,
    phot_g_mean_mag
FROM gaiadr3.gaia_source
WHERE phot_g_mean_mag < 6
ORDER BY phot_g_mean_mag ASC
"""

job = Gaia.launch_job_async(query)
results = job.get_results()

print(f"âœ… Retrieved {len(results)} stars")

# Convert to pandas
df = results.to_pandas()

# Rename columns to match your app loader
df = df.rename(columns={
    "ra": "ra",
    "dec": "dec",
    "phot_g_mean_mag": "mag",
})

# Optional: add readable star names placeholder
df["name"] = df["source_id"].apply(lambda x: f"Gaia DR3 {x}")

# Reorder columns
df = df[["name", "ra", "dec", "mag"]]

# Save CSV
df.to_csv(OUTPUT_CSV, index=False)

print(f"ðŸ“ Saved to {OUTPUT_CSV.resolve()}")
print("ðŸŽ‰ Done! You can now use Gaia DR3 in your app.")
